<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Brioude 2026, a tale of AURA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
canvas{
  width:640px;
  height:480px;
  image-rendering:pixelated;
  background:#f3f0da;
}
</style>
</head>
<body>
<canvas id="game" width="320" height="240"></canvas>

<script>
(()=>{

/* =====================
   CANVAS
===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;
ctx.font = "12px monospace";
const W = canvas.width, H = canvas.height;

/* =====================
   ASSETS
===================== */
const ASSETS = {
  sprites:{
    remy_back:"remy_back.png",
    wauquiez_front:"wauquiez_front.png",
    ciotti_front:"ciotti_front.png",
    maite_front:"maite_front.png",
    edile_front:"edile_front.png"
  },
  background:{ battle:"battle_bg.png" },
  ui:{ cursor:"cursor.png", textbox:"textbox.png" }
};

const IMG={};
function preloadAssets(done){
  const entries=[];
  Object.entries(ASSETS.sprites).forEach(e=>entries.push(e));
  Object.entries(ASSETS.background).forEach(e=>entries.push(e));
  Object.entries(ASSETS.ui).forEach(e=>entries.push(e));
  let loaded=0;
  entries.forEach(([k,src])=>{
    const i=new Image();
    i.onload=()=>{IMG[k]=i;if(++loaded===entries.length)done();};
    i.onerror=()=>{console.warn("Missing",src);if(++loaded===entries.length)done();};
    i.src=src;
  });
}

/* =====================
   UTILS
===================== */
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const chance=p=>Math.random()<p;
const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

/* =====================
   FX
===================== */
const FX={shakeX:0,shakeY:0,shakeFrames:0,flash:0};
function startShake(){FX.shakeFrames=8;}
function updateFX(){
  if(FX.shakeFrames>0){
    FX.shakeX=(Math.random()-0.5)*4;
    FX.shakeY=(Math.random()-0.5)*3;
    FX.shakeFrames--;
  }else FX.shakeX=FX.shakeY=0;
  if(FX.flash>0) FX.flash--;
}

/* =====================
   UI
===================== */
const UI={
  text:"",visible:"",idx:0,typing:false,timer:0,
  queue:[],menu:false,items:[],idxMenu:0,menuKind:"none",
  cooldown:0
};

function showText(t){
  UI.text=t;UI.visible="";UI.idx=0;
  UI.typing=true;UI.timer=0;
  UI.menu=false;UI.menuKind="none";
}
function queueText(t){UI.queue.push(t);}
function updateText(dt){
  if(!UI.typing)return;
  UI.timer+=dt;
  if(UI.timer>30 && UI.idx<UI.text.length){
    UI.visible+=UI.text[UI.idx++];
    UI.timer=0;
  }
  if(UI.idx>=UI.text.length)UI.typing=false;
}
function nextText(){
  if(UI.typing){UI.visible=UI.text;UI.typing=false;return true;}
  if(UI.queue.length){showText(UI.queue.shift());return true;}
  UI.text="";return false;
}
function openMenu(items,kind){
  UI.menu=true;UI.items=items;UI.idxMenu=0;UI.menuKind=kind;
}

/* =====================
   INTRO ANIMATION
===================== */
let gameState="TITLE"; // TITLE INTRO FIGHT ENDING LOST
let introStart=0;
const INTRO_DURATION=700;

/* =====================
   DATA
===================== */
const HERO_STATS={atk:55,def:50,sp:65,spd:60};

function createFighter(name,types,stats,sprite){
  return{
    name,types,sprite,
    maxHP:100,hp:100,
    base:{...stats},mods:{atk:0,def:0,sp:0,spd:0},
    moves:[]
  };
}

const player=createFighter("Remy",["recherche","blague"],HERO_STATS,"remy_back");

/* =====================
   DRAW HELPERS
===================== */
function drawBox(x,y,w,h){
  if(IMG.textbox) ctx.drawImage(IMG.textbox,x,y,w,h);
  else{ctx.fillStyle="#fff";ctx.fillRect(x,y,w,h);ctx.strokeRect(x,y,w,h);}
}
function drawHPBar(x,y,hp,max){
  const w=48,h=4;
  const f=Math.floor(w*(hp/max));
  ctx.fillStyle="#111";ctx.fillRect(x-1,y-1,w+2,h+2);
  ctx.fillStyle="#eee";ctx.fillRect(x,y,w,h);
  ctx.fillStyle="#2a7";ctx.fillRect(x,y,f,h);
}
function drawSprite(k,x,y){
  if(IMG[k]) ctx.drawImage(IMG[k],x,y,64,64);
}

/* =====================
   SCENES
===================== */
function drawBattle(){
  if(IMG.battle) ctx.drawImage(IMG.battle,0,0,W,H);
  else{ctx.fillStyle="#e9e2b8";ctx.fillRect(0,0,W,H);}

  let p=1;
  if(gameState==="INTRO"){
    p=Math.min((performance.now()-introStart)/INTRO_DURATION,1);
  }
  const ease=p*(2-p);

  drawSprite("wauquiez_front",210+(1-ease)*80,40);
  drawSprite("remy_back",40-(1-ease)*80,110);

  drawBox(12,16,160,40);
  ctx.fillStyle="#111";
  ctx.fillText("Laurent Wauquiez",18,30);
  drawHPBar(18,40,100,100);
  ctx.fillText("HP 100/100",18,56);

  drawBox(148,118,164,40);
  ctx.fillText("Remy",154,132);
  ctx.fillText("Recherche / Blague",154,144);
  drawHPBar(154,154,player.hp,player.maxHP);
  ctx.fillText(`HP ${player.hp}/${player.maxHP}`,154,170);
}

function drawTextbox(){
  drawBox(8,168,304,64);
  ctx.fillStyle="#111";
  const lines=(UI.visible||UI.text).split("\n");
  lines.slice(0,3).forEach((l,i)=>ctx.fillText(l,16,188+i*14));
}

/* =====================
   LOOP
===================== */
let last=performance.now();
function loop(now){
  const dt=now-last;last=now;
  if(UI.cooldown>0)UI.cooldown-=dt;
  updateText(dt);updateFX();

  ctx.save();
  ctx.translate(FX.shakeX,FX.shakeY);

  if(gameState==="TITLE"){
    ctx.fillStyle="#f3f0da";ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#111";ctx.textAlign="center";
    ctx.fillText("BRIOUDE 2026",160,80);
    ctx.textAlign="left";
    drawTextbox();
  }else{
    drawBattle();
    if(UI.text||UI.typing) drawTextbox();
  }

  ctx.restore();
  if(FX.flash>0){
    ctx.fillStyle="rgba(255,255,255,0.6)";
    ctx.fillRect(0,0,W,H);
  }
  requestAnimationFrame(loop);
}

/* =====================
   INPUT
===================== */
document.addEventListener("keydown",e=>{
  if(UI.cooldown>0)return;
  if(gameState==="TITLE" && e.key==="Enter"){
    gameState="INTRO";
    introStart=performance.now();
    showText("Un adversaire politique apparait !");
    UI.cooldown=200;
  }
});

/* =====================
   BOOT
===================== */
preloadAssets(()=>{
  showText("Appuie sur Entree");
  requestAnimationFrame(loop);
});

})();
</script>
</body>
</html>
